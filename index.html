<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mexican Bowl Order Tally</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .upload-section { margin-bottom: 30px; padding: 20px; border: 2px dashed #ccc; }
        .tally-section { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .category { margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        input[type="number"] { width: 60px; }
        .manual-edit { background-color: #fffacd; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Mexican Bowl Order Tally</h1>
        
        <div class="upload-section">
            <h2>Upload Google Forms CSV</h2>
            <input type="file" id="csvFile" accept=".csv">
            <button onclick="processCSV()">Process Orders</button>
        </div>

        <div class="tally-section">
            <div class="bowl-category category">
                <h2>Bowl Orders</h2>
                <table id="bowlTally">
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Price</th>
                            <th>Quantity</th>
                            <th>Manual Adjust</th>
                            <th>Subtotal</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>

            <div class="burrito-category category">
                <h2>Burrito Orders</h2>
                <table id="burritoTally">
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Price</th>
                            <th>Quantity</th>
                            <th>Manual Adjust</th>
                            <th>Subtotal</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>

            <div class="extras-category category">
                <h2>Extras</h2>
                <table id="extrasTally">
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Price</th>
                            <th>Quantity</th>
                            <th>Manual Adjust</th>
                            <th>Subtotal</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>

            <div class="summary-category category">
                <h2>Order Summary</h2>
                <div id="orderSummary">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Define your menu items and prices
        const menuItems = {
            bowls: {
                'Basic Bowl - 20 SAR': 20,
                'Regular Bowl (salsa + sour cream) - 25 SAR': 25,
                'Large Combo Bowl - 35 SAR': 35,
                'Mexican Rice (free alternative)': 0
            },
            burritos: {
                'Burrito - 15 SAR': 15,
                'Burrito Combo W/Sour Cream - 20 SAR': 20,
                'Burrito Combo W/Salsa - 20 SAR': 20,
                'Burrito Combo 2 (sour cream + guac + salsa + iced tea) - 25 SAR': 25
            },
            extras: {
                'Extra Protein - 5 SAR': 5,
                'Chips and Salsa - 5 SAR': 5,
                'Lemon Mint Iced Tea - 5 SAR': 5,
                'Strawberry Mint Iced Tea': 0, // Price not specified in your data
                'Guac - 6 SAR': 6,
                'Salsa - 5 SAR': 5,
                'Sour Cream - 4 SAR': 4,
                'Extra Cheese (75 g) - 5 SAR': 5
            }
        };

        let currentTally = {
            bowls: {},
            burritos: {},
            extras: {}
        };

        // Initialize tally with zero quantities
        function initializeTally() {
            for (const category in menuItems) {
                for (const item in menuItems[category]) {
                    currentTally[category][item] = {
                        quantity: 0,
                        manualAdjust: 0,
                        price: menuItems[category][item]
                    };
                }
            }
        }

        function processCSV() {
            const fileInput = document.getElementById('csvFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select a CSV file');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const csvData = e.target.result;
                parseCSVData(csvData);
                updateDisplay();
            };
            reader.readAsText(file);
        }

        function parseCSVData(csvText) {
            // Reset tally
            initializeTally();
            
            const lines = csvText.split('\n');
            const headers = lines[0].split(',').map(header => header.trim());
            
            // Process each order (skip header row)
            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim() === '') continue;
                
                const values = parseCSVLine(lines[i]);
                const order = {};
                
                // Create order object with headers as keys
                headers.forEach((header, index) => {
                    order[header] = values[index] ? values[index].trim() : '';
                });
                
                // Count items in this order
                countOrderItems(order);
            }
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current);
            return result;
        }

        function countOrderItems(order) {
            // Count bowl options
            for (const bowl in menuItems.bowls) {
                const bowlHeader = `Bowl Options [${bowl}]`;
                if (order[bowlHeader] && order[bowlHeader].trim() !== '') {
                    currentTally.bowls[bowl].quantity++;
                }
            }

            // Count burrito options
            for (const burrito in menuItems.burritos) {
                const burritoHeader = `Bowl Options [${burrito}]`;
                if (order[burritoHeader] && order[burritoHeader].trim() !== '') {
                    currentTally.burritos[burrito].quantity++;
                }
            }

            // Count extras
            for (const extra in menuItems.extras) {
                const extraHeader = `Extras [${extra}]`;
                if (order[extraHeader] && order[extraHeader].trim() !== '') {
                    currentTally.extras[extra].quantity++;
                }
            }
        }

        function updateDisplay() {
            updateCategoryTable('bowls', 'bowlTally');
            updateCategoryTable('burritos', 'burritoTally');
            updateCategoryTable('extras', 'extrasTally');
            updateOrderSummary();
        }

        function updateCategoryTable(category, tableId) {
            const tbody = document.querySelector(`#${tableId} tbody`);
            tbody.innerHTML = '';
            
            let categoryTotal = 0;
            
            for (const item in currentTally[category]) {
                const itemData = currentTally[category][item];
                const totalQuantity = itemData.quantity + itemData.manualAdjust;
                const subtotal = totalQuantity * itemData.price;
                categoryTotal += subtotal;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item}</td>
                    <td>${itemData.price} SAR</td>
                    <td>${itemData.quantity}</td>
                    <td>
                        <input type="number" value="${itemData.manualAdjust}" 
                               onchange="updateManualAdjust('${category}', '${item}', this.value)"
                               class="manual-edit">
                    </td>
                    <td>${subtotal} SAR</td>
                `;
                tbody.appendChild(row);
            }
            
            // Add total row
            const totalRow = document.createElement('tr');
            totalRow.style.fontWeight = 'bold';
            totalRow.innerHTML = `
                <td colspan="4">Total</td>
                <td>${categoryTotal} SAR</td>
            `;
            tbody.appendChild(totalRow);
        }

        function updateManualAdjust(category, item, value) {
            currentTally[category][item].manualAdjust = parseInt(value) || 0;
            updateDisplay();
        }

        function updateOrderSummary() {
            const summaryDiv = document.getElementById('orderSummary');
            let grandTotal = 0;
            let summaryHTML = '';
            
            for (const category in currentTally) {
                let categoryTotal = 0;
                for (const item in currentTally[category]) {
                    const itemData = currentTally[category][item];
                    const totalQuantity = itemData.quantity + itemData.manualAdjust;
                    categoryTotal += totalQuantity * itemData.price;
                }
                grandTotal += categoryTotal;
                summaryHTML += `<p><strong>${category.charAt(0).toUpperCase() + category.slice(1)} Total:</strong> ${categoryTotal} SAR</p>`;
            }
            
            summaryHTML += `<h3>Grand Total: ${grandTotal} SAR</h3>`;
            summaryDiv.innerHTML = summaryHTML;
        }

        // Initialize on page load
        initializeTally();
        updateDisplay();
    </script>
</body>
</html>
